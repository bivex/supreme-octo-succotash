openapi: 3.0.3
info:
  title: Advertising Platform API
  description: |
    Domain-driven API for managing advertising campaigns, tracking performance,
    and optimizing conversions. Built from bounded contexts rather than raw SQL schema.
    ## Key Features
    - **Domain-Driven Design**: API designed around business domains, not database tables
    - **Property-Based Testing Ready**: Comprehensive OpenAPI spec for automated testing
    - **Multi-Level Tracking**: 5-level sub-tracking (sub1-sub5) and affiliate tracking
    - **Fraud Detection**: Built-in bot detection and fraud scoring
    - **A/B Testing**: Landing page optimization with control/test groups
    - **Real-time Analytics**: Performance metrics with multiple breakdowns
  version: 1.0.0
  contact:
    name: API Support
    email: api@advertising-platform.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
servers:
  - url: http://127.0.0.1:5000/v1
    description: Local development server (port 5000)
  - url: http://127.0.0.1:8001/v1
    description: Local development server (port 8001)
  - url: https://api.advertising-platform.com/v1
    description: Production server
  - url: https://staging-api.advertising-platform.com/v1
    description: Staging server
# Global rate limiting (applied to all endpoints)
x-rate-limits:
  authenticated:
    requests_per_minute: 60
    requests_per_hour: 1000
  public:
    requests_per_minute: 10
    burst_limit: 50
# ============================================================================
# SECURITY SCHEMES
# ============================================================================
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token for authenticated users
      x-bearerInfoFunc: mock_server.bearer_token_auth
    apiKey:
      type: apiKey
      in: header
      name: X-API-Key
      description: API key for partner integrations
    oauth2:
      type: oauth2
      description: OAuth 2.0 authorization for third-party applications
      flows:
        authorizationCode:
          authorizationUrl: https://auth.advertising-platform.com/oauth/authorize
          tokenUrl: https://auth.advertising-platform.com/oauth/token
          scopes:
            # Campaign scopes
            campaign:read: Read campaign data
            campaign:write: Create and modify campaigns
            campaign:delete: Delete campaigns
            # Landing page scopes (NEW)
            landing:read: Read landing pages
            landing:write: Create and modify landing pages
            # Offer scopes (NEW)
            offers:read: Read offers
            offers:write: Create and modify offers
            # Analytics and traffic
            analytics:read: Read analytics and performance data
            traffic:read: Read traffic and click data
            # Admin
            admin: Full administrative access
# ============================================================================
# COMMON SCHEMAS
# ============================================================================
  schemas:
    # Common Types
    Money:
      type: object
      description: Monetary value with currency
      properties:
        amount:
          type: number
          format: float
          minimum: 0
          maximum: 999999999.99
          example: 25.50
          description: Amount in the specified currency
        currency:
          type: string
          pattern: '^[A-Z]{3}$'
          example: "USD"
          default: "USD"
          description: ISO 4217 currency code (3 uppercase letters)
      required:
        - amount
        - currency
      additionalProperties: false
      example:
        amount: 25.50
        currency: "USD"
    OfferPerformance:
      type: object
      description: Performance metrics for an offer including clicks, conversions, revenue, and calculated metrics
      properties:
        clicks:
          type: integer
          format: int64
          example: 1500
        conversions:
          type: integer
          format: int64
          example: 45
        revenue:
          $ref: '#/components/schemas/Money'
        cost:
          $ref: '#/components/schemas/Money'
        cr:
          type: number
          format: float
          example: 0.03
        epc:
          $ref: '#/components/schemas/Money'
        roi:
          type: number
          format: float
          example: 2.15
      required:
        - clicks
        - conversions
        - revenue
        - cost
        - cr
        - epc
        - roi
      example:
        clicks: 1500
        conversions: 45
        revenue:
          amount: 2250.00
          currency: "USD"
        cost:
          amount: 750.00
          currency: "USD"
        cr: 0.03
        epc:
          amount: 1.50
          currency: "USD"
        roi: 2.15
      additionalProperties: false
    OfferAutoPause:
      type: object
      description: Configuration for automatic pausing of offers based on conversion rate thresholds
      properties:
        threshold:
          type: number
          format: float
          example: 0.02
        minClicksBeforePause:
          type: integer
          example: 1000
      required:
        - threshold
        - minClicksBeforePause
      additionalProperties: false
      example:
        threshold: 0.02
        minClicksBeforePause: 1000
    OfferType:
      description: Type of offer delivery method
      type: string
      enum:
        - direct
        - email
        - phone
      example: "direct"
    OfferMetrics:
      description: Performance metrics for a specific offer
      type: object
      properties:
        offerId:
          type: string
          example: "offer_123"
        name:
          type: string
          example: "Summer Sale Offer"
        metrics:
          $ref: '#/components/schemas/AnalyticsMetrics'
      required:
        - offerId
        - name
        - metrics
      additionalProperties: false
      example:
        offerId: "offer_123"
        name: "Summer Sale Offer"
        metrics:
          clicks: 5000
          conversions: 150
          revenue:
            amount: 7500.00
            currency: "USD"
    # Click Tracking Schemas
    ClickRecord:
      type: object
      description: Complete click tracking record with fraud detection data
      properties:
        id:
          type: string
          format: uuid
          description: Unique click identifier
          example: "123e4567-e89b-12d3-a456-426614174000"
        cid:
          type: integer
          minimum: 1
          maximum: 2147483647
          description: Campaign ID
          example: 123
        ip:
          type: string
          format: ipv4
          description: Client IP address
          example: "192.168.1.100"
        ua:
          type: string
          maxLength: 1000
          description: User agent string
          example: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
        ref:
          type: string
          format: uri
          maxLength: 2000
          nullable: true
          description: HTTP referrer URL
          example: "https://facebook.com/ad/123"
        isValid:
          type: integer
          enum: [0, 1]
          description: Click validity flag (1=valid, 0=invalid/fraudulent)
          example: 1
        ts:
          type: integer
          format: int64
          minimum: 0
          description: Unix timestamp of click
          example: 1640995200
        # Sub-tracking parameters (5-level deep tracking)
        sub1:
          type: string
          maxLength: 255
          nullable: true
          description: "Creative ID"
          example: "fb_ad_15"
        sub2:
          type: string
          maxLength: 255
          nullable: true
          description: "Traffic source"
          example: "facebook"
        sub3:
          type: string
          maxLength: 255
          nullable: true
          description: "Ad set/company"
          example: "adset_12"
        sub4:
          type: string
          maxLength: 255
          nullable: true
          description: "Ad version"
          example: "video1"
        sub5:
          type: string
          maxLength: 255
          nullable: true
          description: "Keyword/audience"
          example: "lookalike78"
        # Affiliate network parameters
        clickId:
          type: string
          maxLength: 255
          nullable: true
          description: "Click ID for postbacks"
          example: "USERCLICK123"
        affSub:
          type: string
          maxLength: 255
          nullable: true
          description: "Affiliate sub ID"
          example: "aff_sub_123"
        affSub2:
          type: string
          maxLength: 255
          nullable: true
          description: "Affiliate sub ID 2"
        affSub3:
          type: string
          maxLength: 255
          nullable: true
          description: "Affiliate sub ID 3"
        affSub4:
          type: string
          maxLength: 255
          nullable: true
          description: "Affiliate sub ID 4"
        affSub5:
          type: string
          maxLength: 255
          nullable: true
          description: "Affiliate sub ID 5"
        # Fraud detection
        fraudScore:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0
          description: Fraud probability score (0.0=legitimate, 1.0=fraudulent)
          example: 0.8
        fraudReason:
          type: string
          nullable: true
          description: Reason for fraud detection
          enum: ["bot_pattern_detected", "missing_user_agent", "ip_blacklisted", "user_agent_blocked", "suspicious_referrer_length", "forced_bot_detection"]
          example: "bot_pattern_detected"
        # Additional tracking
        landingPageId:
          type: integer
          minimum: 1
          nullable: true
          description: ID of landing page used
          example: 456
        campaignOfferId:
          type: integer
          minimum: 1
          nullable: true
          description: ID of offer used
          example: 789
        trafficSourceId:
          type: integer
          minimum: 1
          nullable: true
          description: ID of traffic source
          example: 101
        conversionType:
          allOf:
            - $ref: '#/components/schemas/ConversionType'
          nullable: true
      required:
        - id
        - cid
        - ip
        - ua
        - isValid
        - ts
      example:
        id: "123e4567-e89b-12d3-a456-426614174000"
        cid: 123
        ip: "192.168.1.100"
        ua: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
        isValid: true
        ts: 1640995200
    ClickList:
      description: Paginated list of click records
      type: object
      properties:
        clicks:
          type: array
          items:
            $ref: '#/components/schemas/ClickRecord'
        total:
          type: integer
          format: int64
          example: 1500
        limit:
          type: integer
          example: 50
        offset:
          type: integer
          example: 0
      required:
        - clicks
        - total
      example:
        clicks:
          - id: "123e4567-e89b-12d3-a456-426614174000"
            cid: 123
            ip: "192.168.1.100"
            ua: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
            isValid: true
            ts: 1640995200
        total: 1500
    Pagination:
      description: Pagination information for list responses
      type: object
      properties:
        page:
          type: integer
          minimum: 1
          default: 1
          example: 1
        pageSize:
          type: integer
          minimum: 1
          default: 20
          example: 20
        totalItems:
          type: integer
          format: int64
          example: 150
        totalPages:
          type: integer
          example: 8
        hasNext:
          type: boolean
          example: true
        hasPrev:
          type: boolean
          example: false
        _links:
          $ref: '#/components/schemas/PaginationLinks'
      required:
        - page
        - pageSize
        - totalItems
        - totalPages
        - hasNext
        - hasPrev
      example:
        page: 1
        pageSize: 20
        totalItems: 150
        totalPages: 8
        hasNext: true
        hasPrev: false
    PaginationLinks:
      description: Navigation links for paginated responses
      type: object
      properties:
        first:
          type: string
          format: uri
          example: "/api/v1/campaigns?page=1&pageSize=20"
        prev:
          type: string
          format: uri
          example: "/api/v1/campaigns?page=1&pageSize=20"
        next:
          type: string
          format: uri
          example: "/api/v1/campaigns?page=2&pageSize=20"
        last:
          type: string
          format: uri
          example: "/api/v1/campaigns?page=8&pageSize=20"
      example:
        first: "/api/v1/campaigns?page=1&pageSize=20"
        prev: "/api/v1/campaigns?page=1&pageSize=20"
        next: "/api/v1/campaigns?page=2&pageSize=20"
        last: "/api/v1/campaigns?page=8&pageSize=20"
    # Error Response
    Error:
      type: object
      description: Standardized error response format
      required:
        - error
      properties:
        error:
          type: object
          properties:
            code:
              type: string
              description: Machine-readable error code
              example: VALIDATION_ERROR
              enum:
                - VALIDATION_ERROR
                - NOT_FOUND
                - CONFLICT
                - INVARIANT_VIOLATION
                - UNAUTHENTICATED
                - UNAUTHORIZED
                - METHOD_NOT_ALLOWED
                - NOT_ACCEPTABLE
                - UNSUPPORTED_MEDIA_TYPE
                - TOO_MANY_REQUESTS
                - INTERNAL_SERVER_ERROR
                - SERVICE_UNAVAILABLE
            message:
              type: string
              description: Human-readable error message
              example: "Validation failed: name is required"
            details:
              type: object
              description: Optional object for detailed validation errors
      example:
        error:
          code: "VALIDATION_ERROR"
          message: "Validation failed: name is required"
          details:
            field: "name"
            issue: "required"
    # Enums
    CampaignStatus:
      description: Current status of a campaign
      type: string
      enum:
        - draft
        - active
        - paused
        - completed
        - cancelled
      example: "active"
    PageType:
      description: Type of landing page in the conversion funnel
      type: string
      enum:
        - direct
        - squeeze
        - bridge
        - thank_you
      example: "squeeze"
    ConversionType:
      description: Type of conversion event being tracked
      type: string
      enum:
        - lead
        - sale
        - install
        - registration
        - signup
      example: "sale"
    CostModel:
      description: Cost model for campaign billing (CPA=Cost Per Action, CPC=Cost Per Click, CPM=Cost Per Mille)
      type: string
      enum:
        - CPA
        - CPC
        - CPM
      example: "CPA"
# ============================================================================
# CAMPAIGN MANAGEMENT SCHEMAS
# ============================================================================
    CampaignResource:
      description: Complete campaign configuration and status information
      type: object
      properties:
        id:
          type: string
          example: "camp_123"
        name:
          type: string
          example: "Summer Sale Campaign"
        description:
          type: string
          example: "High-converting summer promotion"
        status:
          $ref: '#/components/schemas/CampaignStatus'
        schedule:
          $ref: '#/components/schemas/CampaignSchedule'
        urls:
          $ref: '#/components/schemas/CampaignURLs'
        financial:
          $ref: '#/components/schemas/CampaignFinancial'
        performance:
          $ref: '#/components/schemas/CampaignPerformance'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        _links:
          $ref: '#/components/schemas/CampaignLinks'
      required:
        - id
        - name
        - status
        - urls
        - createdAt
        - updatedAt
      example:
        id: "camp_123"
        name: "Summer Sale Campaign"
        description: "High-converting summer promotion"
        status: "active"
        schedule:
          startDate: "2024-06-01T00:00:00Z"
          endDate: "2024-08-31T23:59:59Z"
        urls:
          trackingUrl: "https://example.com/track"
          successUrl: "https://example.com/success"
          failureUrl: "https://example.com/failure"
        financial:
          payout: {"amount": 2.50, "currency": "USD"}
          dailyBudget: {"amount": 100.00, "currency": "USD"}
          totalBudget: {"amount": 5000.00, "currency": "USD"}
        performance:
          clicks: 5000
          conversions: 150
          revenue: {"amount": 7500.00, "currency": "USD"}
        createdAt: "2024-01-01T00:00:00Z"
        updatedAt: "2024-01-01T00:00:00Z"
    CampaignSchedule:
      description: Campaign scheduling information including start and end dates
      type: object
      properties:
        startDate:
          type: string
          format: date-time
        endDate:
          type: string
          format: date-time
      example:
        startDate: "2024-06-01T00:00:00Z"
        endDate: "2024-08-31T23:59:59Z"
    CampaignURLs:
      description: URLs for campaign landing pages and offers
      type: object
      properties:
        safePage:
          type: string
          format: uri
          example: "https://example.com/safe-landing"
        offerPage:
          type: string
          format: uri
          example: "https://example.com/offer"
      required:
        - safePage
        - offerPage
      example:
        safePage: "https://example.com/safe-landing"
        offerPage: "https://example.com/offer"
    CampaignFinancial:
      description: Financial configuration and spending information for a campaign
      type: object
      properties:
        costModel:
          $ref: '#/components/schemas/CostModel'
        payout:
          $ref: '#/components/schemas/Money'
        dailyBudget:
          $ref: '#/components/schemas/Money'
        totalBudget:
          $ref: '#/components/schemas/Money'
        spent:
          $ref: '#/components/schemas/Money'
      required:
        - costModel
        - payout
        - spent
      example:
        costModel: "CPA"
        payout: {"amount": 2.50, "currency": "USD"}
        dailyBudget: {"amount": 100.00, "currency": "USD"}
        totalBudget: {"amount": 5000.00, "currency": "USD"}
        spent: {"amount": 1250.00, "currency": "USD"}
    CampaignPerformance:
      description: Key performance metrics and KPIs for a campaign
      type: object
      properties:
        clicks:
          type: integer
          format: int64
          example: 1250
        conversions:
          type: integer
          format: int64
          example: 45
        ctr:
          type: number
          format: float
          example: 0.032
        cr:
          type: number
          format: float
          example: 0.036
        epc:
          $ref: '#/components/schemas/Money'
        roi:
          type: number
          format: float
          example: 2.45
      required:
        - clicks
        - conversions
        - ctr
        - cr
        - epc
        - roi
      example:
        clicks: 1250
        conversions: 45
        ctr: 0.032
        cr: 0.036
        epc: {"amount": 2.50, "currency": "USD"}
        roi: 2.45
    CampaignLinks:
      description: HATEOAS links for campaign-related resources
      type: object
      properties:
        self:
          type: string
          example: "/api/v1/campaigns/camp_123"
        landingPages:
          type: string
          example: "/api/v1/campaigns/camp_123/landing-pages"
        offers:
          type: string
          example: "/api/v1/campaigns/camp_123/offers"
        targeting:
          type: string
          example: "/api/v1/campaigns/camp_123/targeting"
        analytics:
          type: string
          example: "/api/v1/campaigns/camp_123/analytics"
      example:
        self: "/api/v1/campaigns/camp_123"
        landingPages: "/api/v1/campaigns/camp_123/landing-pages"
        offers: "/api/v1/campaigns/camp_123/offers"
        targeting: "/api/v1/campaigns/camp_123/targeting"
        analytics: "/api/v1/campaigns/camp_123/analytics"
    CampaignCollection:
      description: Collection of campaign summaries with pagination
      type: object
      properties:
        campaigns:
          type: array
          items:
            $ref: '#/components/schemas/CampaignSummary'
        pagination:
          $ref: '#/components/schemas/Pagination'
      required:
        - campaigns
        - pagination
      example:
        campaigns:
          - id: "camp_123"
            name: "Summer Sale Campaign"
            status: "active"
            clicks: 1250
            conversions: 45
        pagination:
          page: 1
          pageSize: 20
          totalItems: 5
          totalPages: 1
          hasNext: false
          hasPrev: false
    CampaignSummary:
      description: Condensed campaign information for list views
      type: object
      properties:
        id:
          type: string
          example: "camp_123"
        name:
          type: string
          example: "Summer Sale Campaign"
        status:
          $ref: '#/components/schemas/CampaignStatus'
        performance:
          $ref: '#/components/schemas/CampaignPerformance'
        _links:
          $ref: '#/components/schemas/CampaignLinks'
      required:
        - id
        - name
        - status
        - performance
      example:
        id: "camp_123"
        name: "Summer Sale Campaign"
        status: "active"
        performance:
          clicks: 1250
          conversions: 45
          ctr: 0.032
          cr: 0.036
          epc: {"amount": 2.50, "currency": "USD"}
          roi: 2.45
# ============================================================================
# LANDING PAGE SCHEMAS
# ============================================================================
    LandingPageResource:
      type: object
      properties:
        id:
          type: string
          example: "lp_456"
        campaignId:
          type: string
          example: "camp_123"
        name:
          type: string
          example: "Main Squeeze Page"
        url:
          type: string
          format: uri
          example: "https://example.com/page1"
        pageType:
          $ref: '#/components/schemas/PageType'
        weight:
          type: integer
          minimum: 0
          example: 70
        isActive:
          type: boolean
          example: true
        isControl:
          type: boolean
          example: false
        performance:
          $ref: '#/components/schemas/LandingPagePerformance'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - id
        - campaignId
        - name
        - url
        - pageType
        - weight
        - isActive
        - isControl
        - createdAt
        - updatedAt
    LandingPagePerformance:
      type: object
      properties:
        impressions:
          type: integer
          format: int64
          example: 5000
        clicks:
          type: integer
          format: int64
          example: 250
        conversions:
          type: integer
          format: int64
          example: 15
        ctr:
          type: number
          format: float
          example: 0.05
        cr:
          type: number
          format: float
          example: 0.06
        epc:
          $ref: '#/components/schemas/Money'
      required:
        - impressions
        - clicks
        - conversions
        - ctr
        - cr
        - epc
# ============================================================================
# CAMPAIGN OFFER SCHEMAS
# ============================================================================
    CampaignOfferResource:
      type: object
      properties:
        id:
          type: string
          example: "offer_789"
        campaignId:
          type: string
          example: "camp_123"
        name:
          type: string
          example: "Premium Product"
        url:
          type: string
          format: uri
          example: "https://affiliate.com/offer/123"
        offerType:
          $ref: '#/components/schemas/OfferType'
        weight:
          type: integer
          minimum: 0
          example: 60
        isActive:
          type: boolean
          example: true
        isControl:
          type: boolean
          example: false
        payout:
          $ref: '#/components/schemas/Money'
        revenueShare:
          type: number
          format: float
          minimum: 0
          maximum: 1
          example: 0.15
        costPerClick:
          $ref: '#/components/schemas/Money'
        performance:
          $ref: '#/components/schemas/OfferPerformance'
        autoPause:
          $ref: '#/components/schemas/OfferAutoPause'
        externalId:
          type: string
          example: "AFF_123"
        partnerNetwork:
          type: string
          example: "MaxBounty"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - id
        - campaignId
        - name
        - url
        - offerType
        - weight
        - isActive
        - isControl
        - payout
        - createdAt
        - updatedAt
# ============================================================================
# ANALYTICS SCHEMAS
# ============================================================================
    CampaignAnalytics:
      type: object
      properties:
        campaignId:
          type: string
          example: "camp_123"
        timeRange:
          $ref: '#/components/schemas/AnalyticsTimeRange'
        metrics:
          $ref: '#/components/schemas/AnalyticsMetrics'
        breakdowns:
          $ref: '#/components/schemas/AnalyticsBreakdowns'
      required:
        - campaignId
        - timeRange
        - metrics
    AnalyticsTimeRange:
      type: object
      properties:
        startDate:
          type: string
          format: date
          example: "2024-01-01"
        endDate:
          type: string
          format: date
          example: "2024-01-31"
        granularity:
          type: string
          enum: [hour, day, week, month]
          default: day
          example: "day"
      required:
        - startDate
        - endDate
        - granularity
    AnalyticsMetrics:
      description: Comprehensive analytics metrics for performance tracking
      type: object
      properties:
        clicks:
          type: integer
          format: int64
          example: 5000
        uniqueClicks:
          type: integer
          format: int64
          example: 4800
        conversions:
          type: integer
          format: int64
          example: 150
        revenue:
          $ref: '#/components/schemas/Money'
        cost:
          $ref: '#/components/schemas/Money'
        ctr:
          type: number
          format: float
          example: 0.025
        cr:
          type: number
          format: float
          example: 0.03
        epc:
          $ref: '#/components/schemas/Money'
        roi:
          type: number
          format: float
          example: 2.15
      required:
        - clicks
        - uniqueClicks
        - conversions
        - revenue
        - cost
        - ctr
        - cr
        - epc
        - roi
      example:
        clicks: 5000
        uniqueClicks: 4800
        conversions: 150
        revenue: {"amount": 7500.00, "currency": "USD"}
        cost: {"amount": 1500.00, "currency": "USD"}
        ctr: 0.025
        cr: 0.03
        epc: {"amount": 2.50, "currency": "USD"}
        roi: 2.15
    AnalyticsBreakdowns:
      type: object
      properties:
        byDate:
          type: array
          items:
            $ref: '#/components/schemas/DateMetrics'
        byTrafficSource:
          type: array
          items:
            $ref: '#/components/schemas/TrafficSourceMetrics'
        byLandingPage:
          type: array
          items:
            $ref: '#/components/schemas/LandingPageMetrics'
        byOffer:
          type: array
          items:
            $ref: '#/components/schemas/OfferMetrics'
        byGeography:
          type: array
          items:
            $ref: '#/components/schemas/GeographyMetrics'
        byDevice:
          type: array
          items:
            $ref: '#/components/schemas/DeviceMetrics'
    DateMetrics:
      type: object
      properties:
        date:
          type: string
          format: date
          example: "2024-01-15"
        metrics:
          $ref: '#/components/schemas/AnalyticsMetrics'
      required:
        - date
        - metrics
    TrafficSourceMetrics:
      type: object
      properties:
        trafficSourceId:
          type: string
          example: "ts_google"
        name:
          type: string
          example: "Google Ads"
        metrics:
          $ref: '#/components/schemas/AnalyticsMetrics'
      required:
        - trafficSourceId
        - name
        - metrics
    LandingPageMetrics:
      type: object
      properties:
        landingPageId:
          type: string
          example: "lp_456"
        name:
          type: string
          example: "Main Landing Page"
        metrics:
          $ref: '#/components/schemas/AnalyticsMetrics'
      required:
        - landingPageId
        - name
        - metrics
    GeographyMetrics:
      type: object
      properties:
        country:
          type: string
          example: "US"
        metrics:
          $ref: '#/components/schemas/AnalyticsMetrics'
      required:
        - country
        - metrics
    DeviceMetrics:
      description: Analytics metrics broken down by device type
      type: object
      properties:
        device:
          type: string
          example: "desktop"
        metrics:
          $ref: '#/components/schemas/AnalyticsMetrics'
      required:
        - device
        - metrics
      example:
        device: "desktop"
        metrics:
          clicks: 1500
          conversions: 75
          revenue:
            amount: 3750.00
            currency: "USD"
# ============================================================================
# REQUEST SCHEMAS
# ============================================================================
    UpdateCampaignRequest:
      description: Request payload for updating an existing campaign
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
        description:
          type: string
          maxLength: 1000
        whiteUrl:
          type: string
          format: uri
        blackUrl:
          type: string
          format: uri
        payout:
          $ref: '#/components/schemas/Money'
        dailyBudget:
          $ref: '#/components/schemas/Money'
        totalBudget:
          $ref: '#/components/schemas/Money'
        startDate:
          type: string
          format: date-time
        endDate:
          type: string
          format: date-time
      example:
        name: "Updated Summer Campaign"
        description: "Updated campaign for summer promotions"
        whiteUrl: "https://example.com/allowed"
        blackUrl: "https://example.com/blocked"
        payout:
          amount: 2.50
          currency: "USD"
        dailyBudget:
          amount: 100.00
          currency: "USD"
        totalBudget:
          amount: 5000.00
          currency: "USD"
        startDate: "2024-06-01T00:00:00Z"
        endDate: "2024-08-31T23:59:59Z"
# ============================================================================
# WEBHOOK SCHEMAS
# ============================================================================
    TelegramWebhookRequest:
      type: object
      description: Telegram webhook update payload
      properties:
        update_id:
          type: integer
          description: Unique update identifier
          example: 123456789
        message:
          type: object
          description: Message object from Telegram
          properties:
            message_id:
              type: integer
              example: 123
            from:
              type: object
              description: Sender information
              properties:
                id:
                  type: integer
                  example: 123456789
                username:
                  type: string
                  example: "john_doe"
                first_name:
                  type: string
                  example: "John"
                last_name:
                  type: string
                  example: "Doe"
            chat:
              type: object
              properties:
                id:
                  type: integer
                  example: 123456789
                type:
                  type: string
                  example: "private"
            date:
              type: integer
              description: Unix timestamp
              example: 1640995200
            text:
              type: string
              description: Message text
              example: "/start"
      required:
        - update_id
        - message
      example:
        update_id: 123456789
        message:
          message_id: 123
          from:
            id: 123456789
            username: "john_doe"
            first_name: "John"
            last_name: "Doe"
          chat:
            id: 123456789
            type: "private"
          date: 1640995200
          text: "/start"
    TelegramWebhookResponse:
      description: Response from Telegram webhook processing
      type: object
      properties:
        status:
          type: string
          enum: [success, error, skipped]
          example: "success"
        webhook_id:
          type: string
          description: Internal webhook identifier
          example: "550e8400-e29b-41d4-a716-446655440000"
        response:
          type: object
          description: Bot response to send back to Telegram
          properties:
            chat_id:
              type: integer
              example: 123456789
            text:
              type: string
              example: "üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!"
            reply_markup:
              type: object
              description: Inline keyboard markup
        message:
          type: string
          description: Error message if status is error
          example: "Invalid update format"
      example:
        status: "success"
        webhook_id: "550e8400-e29b-41d4-a716-446655440000"
        response:
          chat_id: 123456789
          text: "üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!"
          reply_markup:
            inline_keyboard:
              - [{"text": "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", "callback_data": "stats"}, {"text": "üöÄ –ö–∞–º–ø–∞–Ω–∏–∏", "callback_data": "campaigns"}]
    # Event Tracking Schemas
    EventTrackingRequest:
      type: object
      description: Event tracking data from landing pages
      properties:
        event_type:
          type: string
          enum: [page_view, click, form_submit, form_start, form_complete, scroll, time_spent, conversion, purchase, signup, download, share, search, video_play, video_complete, custom]
          description: Type of event being tracked
          example: "click"
        event_name:
          type: string
          description: Specific event name
          example: "cta_button_click"
        user_id:
          type: string
          description: Anonymous user identifier
          example: "user_a1b2c3d4"
        session_id:
          type: string
          description: Session identifier
          example: "session_123456"
        click_id:
          type: string
          description: Associated click ID from traffic tracking
          example: "123e4567-e89b-12d3-a456-426614174000"
        campaign_id:
          type: integer
          description: Campaign identifier
          example: 123
        landing_page_id:
          type: integer
          description: Landing page identifier
          example: 456
        url:
          type: string
          format: uri
          description: Current page URL
          example: "https://example.com/landing-page"
        referrer:
          type: string
          format: uri
          description: Referrer URL
          example: "https://facebook.com/ad/123"
        properties:
          type: object
          description: Custom event properties
          additionalProperties: true
          example:
            button_text: "Buy Now"
            form_field: "email"
            scroll_depth: 75
      required:
        - event_type
        - event_name
      example:
        event_type: "click"
        event_name: "cta_button_click"
        user_id: "user_a1b2c3d4"
        session_id: "session_123456"
        click_id: "123e4567-e89b-12d3-a456-426614174000"
        campaign_id: 123
        landing_page_id: 456
        url: "https://example.com/landing-page"
        referrer: "https://facebook.com/ad/123"
        properties:
          button_text: "Buy Now"
          button_position: "hero_section"
    EventTrackingResponse:
      description: Response from event tracking processing
      type: object
      properties:
        status:
          type: string
          enum: [success, error]
          example: "success"
        event_id:
          type: string
          description: Unique event identifier
          example: "550e8400-e29b-41d4-a716-446655440000"
        categories:
          type: array
          items:
            type: string
          description: Event categories for analytics
          example: ["interaction", "cta_interaction"]
        fraud_detected:
          type: boolean
          description: Whether fraudulent activity was detected
          example: false
        message:
          type: string
          description: Error message if status is error
          example: "Invalid event data"
      example:
        status: "success"
        event_id: "550e8400-e29b-41d4-a716-446655440000"
        categories: ["interaction", "cta_interaction"]
        fraud_detected: false
    # Conversion Tracking Schemas
    ConversionTrackingRequest:
      type: object
      description: Conversion tracking data from external systems
      properties:
        click_id:
          type: string
          format: uuid
          description: Click ID that led to this conversion
          example: "123e4567-e89b-12d3-a456-426614174000"
        conversion_type:
          type: string
          enum: [lead, sale, install, registration, signup]
          description: Type of conversion
          example: "sale"
        conversion_value:
          allOf:
            - $ref: '#/components/schemas/Money'
          description: Revenue value of the conversion
        order_id:
          type: string
          description: External order/transaction identifier
          example: "ORDER_123456"
        product_id:
          type: string
          description: Product or service identifier
          example: "product_789"
        metadata:
          type: object
          description: Additional conversion data
          additionalProperties: true
          example:
            source: "web_store"
            payment_method: "credit_card"
            discount_applied: true
      required:
        - click_id
        - conversion_type
      example:
        click_id: "123e4567-e89b-12d3-a456-426614174000"
        conversion_type: "sale"
        conversion_value:
          amount: 99.99
          currency: "USD"
        order_id: "ORDER_123456"
        product_id: "product_789"
        metadata:
          source: "web_store"
          payment_method: "credit_card"
          discount_applied: true
    ConversionTrackingResponse:
      description: Response from conversion tracking processing
      type: object
      properties:
        status:
          type: string
          enum: [success, error, duplicate]
          example: "success"
        conversion_id:
          type: string
          description: Unique conversion identifier
          example: "550e8400-e29b-41d4-a716-446655440000"
        attribution:
          type: object
          description: Attribution data for the conversion
          properties:
            attribution_model:
              type: string
              example: "last_click"
            attribution_confidence:
              type: number
              format: float
              example: 0.9
            time_to_conversion:
              type: number
              format: float
              description: Seconds between click and conversion
              example: 3600.5
            touchpoints:
              type: integer
              example: 1
        fraud_detected:
          type: boolean
          description: Whether fraudulent activity was detected
          example: false
        postback_triggered:
          type: boolean
          description: Whether postback notifications were triggered
          example: true
        message:
          type: string
          description: Error message if status is error
          example: "Click ID not found"
      example:
        status: "success"
        conversion_id: "550e8400-e29b-41d4-a716-446655440000"
        attribution:
          attribution_model: "last_click"
          attribution_confidence: 0.9
          time_to_conversion: 3600.5
          touchpoints: 1
        fraud_detected: false
        postback_triggered: true
    # Click Generation Schemas
    ClickGenerationRequest:
      type: object
      description: Request to generate click tracking URL(s)
      properties:
        campaign_id:
          type: integer
          description: Campaign ID to attribute clicks to
          example: 123
        base_url:
          type: string
          format: uri
          description: Base URL to add tracking parameters to
          example: "https://example.com/landing-page"
        landing_page_id:
          type: integer
          description: Specific landing page ID to target
          example: 456
        offer_id:
          type: integer
          description: Specific offer ID to target
          example: 789
        params:
          type: object
          description: Tracking parameters to include
          properties:
            sub1:
              type: string
              maxLength: 255
              description: Level 1 tracking parameter (Creative/Ad ID)
              example: "fb_ad_15"
            sub2:
              type: string
              maxLength: 255
              description: Level 2 tracking parameter (Traffic Source)
              example: "facebook"
            sub3:
              type: string
              maxLength: 255
              description: Level 3 tracking parameter (Ad Set/Campaign Group)
              example: "prospecting"
            sub4:
              type: string
              maxLength: 255
              description: Level 4 tracking parameter (Ad Version/Creative Type)
              example: "video1"
            sub5:
              type: string
              maxLength: 255
              description: Level 5 tracking parameter (Audience/Keyword)
              example: "lookalike78"
            click_id:
              type: string
              maxLength: 255
              description: Affiliate network click ID
              example: "USERCLICK123"
            aff_sub:
              type: string
              maxLength: 255
              description: Primary affiliate sub-identifier
            aff_sub2:
              type: string
              maxLength: 255
              description: Secondary affiliate sub-identifier
            aff_sub3:
              type: string
              maxLength: 255
              description: Tertiary affiliate sub-identifier
            aff_sub4:
              type: string
              maxLength: 255
              description: Quaternary affiliate sub-identifier
            aff_sub5:
              type: string
              maxLength: 255
              description: Quinary affiliate sub-identifier
      required:
        - campaign_id
        - base_url
      example:
        campaign_id: 123
        base_url: "https://example.com/landing-page"
        landing_page_id: 456
        offer_id: 789
        params:
          sub1: "fb_ad_15"
          sub2: "facebook"
          sub3: "prospecting"
          sub4: "video1"
          sub5: "lookalike78"
          click_id: "USERCLICK123"
    BulkClickGenerationRequest:
      type: object
      description: Request to generate multiple click tracking URLs
      properties:
        campaign_id:
          type: integer
          description: Campaign ID for all URLs
          example: 123
        base_url:
          type: string
          format: uri
          description: Base URL for all variations
          example: "https://example.com/landing-page"
        variations:
          type: array
          description: Array of parameter variations
          items:
            type: object
            properties:
              id:
                type: string
                description: Unique identifier for this variation
                example: "variation_1"
              name:
                type: string
                description: Human-readable name for this variation
                example: "Facebook Prospecting"
              landing_page_id:
                type: integer
                description: Landing page ID for this variation
                example: 456
              offer_id:
                type: integer
                description: Offer ID for this variation
                example: 789
              params:
                type: object
                description: Tracking parameters for this variation
                additionalProperties: true
                example:
                  sub1: "fb_ad_15"
                  sub2: "facebook"
                  sub3: "prospecting"
          minItems: 1
          maxItems: 100
      required:
        - campaign_id
        - base_url
        - variations
      example:
        campaign_id: 123
        base_url: "https://example.com/landing-page"
        variations:
          - id: "variation_1"
            name: "Facebook Prospecting"
            landing_page_id: 456
            offer_id: 789
            params:
              sub1: "fb_ad_15"
              sub2: "facebook"
              sub3: "prospecting"
          - id: "variation_2"
            name: "Google Search"
            landing_page_id: 457
            offer_id: 790
            params:
              sub1: "google_ad_20"
              sub2: "google"
              sub3: "search"
    ClickGenerationResponse:
      description: Response containing generated click tracking URL
      type: object
      properties:
        status:
          type: string
          enum: [success, error]
          example: "success"
        tracking_url:
          type: string
          format: uri
          description: Generated tracking URL
          example: "https://example.com/landing-page?cid=123&ts=1640995200&sub1=fb_ad_15&sub2=facebook"
        campaign_id:
          type: integer
          description: Campaign ID used
          example: 123
        params:
          type: object
          description: Optimized tracking parameters used
          additionalProperties: true
          example:
            sub1: "fb_ad_15"
            sub2: "facebook"
            _generated_at: 1640995200
            _version: "1.0"
        landing_page_id:
          type: integer
          description: Landing page ID used
          example: 456
        offer_id:
          type: integer
          description: Offer ID used
          example: 789
        message:
          type: string
          description: Error message if status is error
          example: "campaign_id must be a positive integer"
      example:
        status: "success"
        tracking_url: "https://example.com/landing-page?cid=123&ts=1640995200&sub1=fb_ad_15&sub2=facebook"
        campaign_id: 123
        params:
          sub1: "fb_ad_15"
          sub2: "facebook"
          _generated_at: 1640995200
          _version: "1.0"
        landing_page_id: 456
        offer_id: 789
    BulkClickGenerationResponse:
      description: Response containing multiple generated click tracking URLs
      type: object
      properties:
        status:
          type: string
          enum: [success, error]
          example: "success"
        total_variations:
          type: integer
          description: Total number of variations requested
          example: 3
        successful:
          type: integer
          description: Number of successfully generated URLs
          example: 2
        failed:
          type: integer
          description: Number of failed generations
          example: 1
        results:
          type: array
          description: Results for each variation
          items:
            type: object
            properties:
              id:
                type: string
                description: Variation identifier
                example: "variation_1"
              name:
                type: string
                description: Variation name
                example: "Facebook Prospecting"
              url:
                type: string
                format: uri
                description: Generated tracking URL (null if failed)
                example: "https://example.com/landing-page?cid=123&ts=1640995200&sub1=fb_ad_15"
              params:
                type: object
                description: Parameters used for this variation
                additionalProperties: true
              status:
                type: string
                enum: [success, error]
                example: "success"
              error:
                type: string
                description: Error message if status is error
                example: "Invalid landing_page_id"
        message:
          type: string
          description: General error message if status is error
          example: "Bulk generation failed"
      example:
        status: "success"
        total_variations: 3
        successful: 2
        failed: 1
        results:
          - id: "variation_1"
            name: "Facebook Prospecting"
            url: "https://example.com/landing-page?cid=123&ts=1640995200&sub1=fb_ad_15"
            params:
              sub1: "fb_ad_15"
              sub2: "facebook"
            status: "success"
          - id: "variation_2"
            name: "Google Search"
            url: "https://example.com/landing-page?cid=123&ts=1640995200&sub1=google_ad_20"
            params:
              sub1: "google_ad_20"
              sub2: "google"
            status: "success"
    # Goal Management Schemas
    GoalResource:
      description: Conversion goal configuration and settings
      type: object
      properties:
        id:
          type: string
          description: Unique goal identifier
          example: "goal_550e8400-e29b-41d4-a716-446655440000"
        campaign_id:
          type: integer
          description: Campaign this goal belongs to
          example: 123
        name:
          type: string
          description: Goal name
          example: "Lead Form Submission"
        description:
          type: string
          description: Goal description
          example: "Track when visitors submit lead capture forms"
        goal_type:
          type: string
          enum: [lead, sale, signup, registration, download, view, time_spent, custom]
          description: Type of conversion goal
          example: "lead"
        trigger_type:
          type: string
          enum: [event, url, time, manual]
          description: How the goal is triggered
          example: "event"
        trigger_config:
          type: object
          description: Configuration for goal triggering
          additionalProperties: true
          example:
            event_type: "form_submit"
            event_name: "lead_form_submit"
        value_config:
          type: object
          description: Configuration for goal value calculation
          additionalProperties: true
          example:
            fixed_value: 10.00
        is_active:
          type: boolean
          description: Whether goal is active
          example: true
        attribution_window_days:
          type: integer
          description: Days to attribute conversions to this goal
          example: 30
        priority:
          type: integer
          description: Goal evaluation priority (higher = more important)
          example: 1
        tags:
          type: array
          items:
            type: string
          description: Tags for categorization
          example: ["form", "lead", "conversion"]
        created_at:
          type: string
          format: date-time
          description: Goal creation timestamp
        updated_at:
          type: string
          format: date-time
          description: Goal last update timestamp
      example:
        id: "goal_550e8400-e29b-41d4-a716-446655440000"
        campaign_id: 123
        name: "Lead Form Submission"
        description: "Track when visitors submit lead capture forms"
        goal_type: "lead"
        trigger_type: "event"
        trigger_config:
          event_type: "form_submit"
          event_name: "lead_form_submit"
        value_config:
          fixed_value: 10.00
        is_active: true
        attribution_window_days: 30
        priority: 1
        tags: ["form", "lead", "conversion"]
        created_at: "2024-01-01T00:00:00Z"
        updated_at: "2024-01-01T00:00:00Z"
    CreateGoalRequest:
      type: object
      description: Request to create a new conversion goal
      properties:
        campaign_id:
          type: integer
          description: Campaign ID for the goal
          example: 123
        name:
          type: string
          minLength: 1
          maxLength: 255
          description: Goal name
          example: "Lead Form Submission"
        description:
          type: string
          maxLength: 1000
          description: Goal description
        goal_type:
          type: string
          enum: [lead, sale, signup, registration, download, view, time_spent, custom]
          description: Type of conversion goal
          example: "lead"
        trigger_type:
          type: string
          enum: [event, url, time, manual]
          description: How the goal is triggered
          example: "event"
        trigger_config:
          type: object
          description: Configuration for goal triggering
          additionalProperties: true
          example:
            event_type: "form_submit"
            event_name: "lead_form_submit"
        value_config:
          type: object
          description: Configuration for goal value calculation
          additionalProperties: true
          example:
            fixed_value: 10.00
        is_active:
          type: boolean
          default: true
          description: Whether goal should be active
        attribution_window_days:
          type: integer
          minimum: 1
          maximum: 365
          default: 30
          description: Attribution window in days
        priority:
          type: integer
          minimum: 1
          maximum: 100
          default: 1
          description: Goal priority
        tags:
          type: array
          items:
            type: string
          description: Tags for categorization
      required:
        - campaign_id
        - name
        - goal_type
        - trigger_type
      example:
        campaign_id: 123
        name: "Lead Form Submission"
        description: "Track when visitors submit lead capture forms"
        goal_type: "lead"
        trigger_type: "event"
        trigger_config:
          event_type: "form_submit"
          event_name: "lead_form_submit"
        value_config:
          fixed_value: 10.00
        is_active: true
        attribution_window_days: 30
        priority: 1
        tags: ["form", "lead", "conversion"]
    UpdateGoalRequest:
      type: object
      description: Request to update an existing goal
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
          description: Goal name
        description:
          type: string
          maxLength: 1000
          description: Goal description
        trigger_config:
          type: object
          description: Configuration for goal triggering
          additionalProperties: true
        value_config:
          type: object
          description: Configuration for goal value calculation
          additionalProperties: true
        is_active:
          type: boolean
          description: Whether goal is active
        attribution_window_days:
          type: integer
          minimum: 1
          maximum: 365
          description: Attribution window in days
        priority:
          type: integer
          minimum: 1
          maximum: 100
          description: Goal priority
        tags:
          type: array
          items:
            type: string
          description: Tags for categorization
      example:
        name: "Updated Lead Goal"
        description: "Updated goal for tracking lead conversions"
        is_active: true
        priority: 2
        tags: ["form", "lead", "updated"]
    GoalCollection:
      description: Collection of conversion goals with pagination
      type: object
      properties:
        goals:
          type: array
          items:
            $ref: '#/components/schemas/GoalResource'
        total:
          type: integer
          description: Total number of goals
          example: 5
        pagination:
          $ref: '#/components/schemas/Pagination'
      example:
        goals:
          - id: "goal_550e8400-e29b-41d4-a716-446655440000"
            campaign_id: 123
            name: "Lead Form Submission"
            description: "Track when visitors submit lead capture forms"
            goal_type: "lead"
            trigger_type: "event"
            is_active: true
            attribution_window_days: 30
        total: 5
        pagination:
          page: 1
          pageSize: 20
          totalItems: 5
          totalPages: 1
          hasNext: false
          hasPrev: false
    GoalTemplate:
      type: object
      description: Predefined goal template
      properties:
        name:
          type: string
          example: "Lead Form Submission"
        description:
          type: string
          example: "Track when visitors submit lead capture forms"
        goal_type:
          type: string
          enum: [lead, sale, signup, registration, download, view, time_spent, custom]
          example: "lead"
        trigger_type:
          type: string
          enum: [event, url, time, manual]
          example: "event"
        trigger_config:
          type: object
          additionalProperties: true
          example:
            event_type: "form_submit"
            event_name: "lead_form_submit"
        value_config:
          type: object
          additionalProperties: true
          example:
            value_field: "lead_value"
        attribution_window_days:
          type: integer
          example: 30
        tags:
          type: array
          items:
            type: string
          example: ["form", "lead", "conversion"]
      example:
        name: "Lead Form Submission"
        description: "Track when visitors submit lead capture forms"
        goal_type: "lead"
        trigger_type: "event"
        trigger_config:
          event_type: "form_submit"
          event_name: "lead_form_submit"
        value_config:
          value_field: "lead_value"
        attribution_window_days: 30
        tags: ["form", "lead", "conversion"]
    # Postback Schemas
    PostbackConfig:
      type: object
      description: Configuration for postback notification
      properties:
        url:
          type: string
          format: uri
          description: Postback URL to send notification to
          example: "https://affiliate-network.com/postback?click_id={click_id}&amount={revenue}"
        method:
          type: string
          enum: [GET, POST, PUT]
          default: GET
          description: HTTP method to use for postback
          example: "GET"
        headers:
          type: object
          description: Custom headers to include in postback request
          additionalProperties:
            type: string
          example:
            Authorization: "Bearer your_token_here"
            X-API-Key: "your_api_key"
        payload:
          type: object
          description: Request payload for POST/PUT methods (overrides URL parameters)
          additionalProperties: true
          example:
            click_id: "{click_id}"
            conversion_type: "{conversion_type}"
            revenue: "{revenue}"
            currency: "{currency}"
        max_attempts:
          type: integer
          minimum: 1
          maximum: 10
          default: 3
          description: Maximum number of delivery attempts
          example: 3
      required:
        - url
      example:
        url: "https://affiliate-network.com/postback?click_id={click_id}&amount={revenue}"
        method: "GET"
        headers:
          Authorization: "Bearer your_token_here"
          X-API-Key: "your_api_key"
        max_attempts: 3
    PostbackSendRequest:
      type: object
      description: Request to send postback notification
      properties:
        conversion_id:
          type: string
          format: uuid
          description: Conversion ID to send postback for
          example: "550e8400-e29b-41d4-a716-446655440000"
        postback_config:
          $ref: '#/components/schemas/PostbackConfig'
      required:
        - conversion_id
        - postback_config
      example:
        conversion_id: "550e8400-e29b-41d4-a716-446655440000"
        postback_config:
          url: "https://affiliate-network.com/postback?click_id={click_id}&amount={revenue}"
          method: "GET"
          max_attempts: 3
    PostbackSendResponse:
      description: Response from postback notification delivery
      type: object
      properties:
        status:
          type: string
          enum: [success, failed, error]
          example: "success"
        postback_id:
          type: string
          description: Unique postback identifier
          example: "550e8400-e29b-41d4-a716-446655440000"
        response_code:
          type: integer
          description: HTTP response code from postback endpoint
          example: 200
        response_body:
          type: string
          description: Response body from postback endpoint
          example: "OK"
        error_message:
          type: string
          description: Error message if delivery failed
          example: "Connection timeout"
        attempt_count:
          type: integer
          description: Number of attempts made
          example: 1
        message:
          type: string
          description: General status message
          example: "Postback sent successfully"
      example:
        status: "success"
        postback_id: "550e8400-e29b-41d4-a716-446655440000"
        response_code: 200
        response_body: "OK"
        attempt_count: 1
        message: "Postback sent successfully"
# ============================================================================
# API PATHS
# ============================================================================
paths:
  # ============================================================================
  # HEALTH CHECK
  # ============================================================================
  /health:
    get:
      summary: Health check
      description: Get the health status of the API service
      operationId: getHealth
      tags: [Health]
      security: []  # Public endpoint - no authentication required
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "healthy"
                  service:
                    type: string
                    example: "domain-driven-api-mock"
        '400':
          description: Bad request - invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Health endpoint not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  # ============================================================================
  # CAMPAIGN MANAGEMENT
  # ============================================================================
  /campaigns:
    get:
      summary: List campaigns
      description: |
        Get a paginated list of campaigns accessible to the authenticated user.
        **Supported Methods**: GET, POST
        **Rate Limit**: 60 requests/minute (authenticated)
      operationId: getCampaigns
      tags: [Campaigns]
      security:
        - bearerAuth: [campaign:read]
        - oauth2: [campaign:read]
      parameters:
        - name: page
          in: query
          description: Page number for pagination (starts from 1)
          schema:
            type: integer
            default: 1
        - name: pageSize
          in: query
          description: Number of items per page
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignCollection'
          links:
            GetCampaign:
              operationId: getCampaignById
              parameters:
                campaignid: '$response.body#/campaigns/0/id'
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      summary: Create campaign
      description: |
        Create a new advertising campaign with specified parameters.
        **Supported Methods**: GET, POST
        **Rate Limit**: 30 requests/minute (authenticated)
        **Content-Type**: application/json
      operationId: createCampaign
      tags: [Campaigns]
      security:
        - bearerAuth: [campaign:write]
        - oauth2: [campaign:write]
      requestBody:
        required: false  # Make optional to allow testing without body
        content:
          application/json:
            schema:
              {}  # Accept any JSON - validation done in handler
      responses:
        '201':
          description: Campaign created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignResource'
          links:
            GetCampaign:
              operationId: getCampaignById
              parameters:
                campaignid: '$response.body#/id'
          headers:
            Location:
              description: URL of the created campaign
              schema:
                type: string
                format: uri
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /campaigns/{campaignid}:
    get:
      summary: Get campaign
      description: |
        Get detailed information about a specific campaign including performance metrics.
        **Supported Methods**: GET, PUT, DELETE
        **Rate Limit**: 120 requests/minute (authenticated)
      operationId: getCampaignById
      tags: [Campaigns]
      security:
        - bearerAuth: [campaign:read]
        - oauth2: [campaign:read]
      parameters:
        - name: campaignid
          in: path
          description: Unique identifier of the campaign
          required: true
          schema:
            type: string
          example: "camp_123"
      responses:
        '200':
          description: Campaign details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignResource'
        '404':
          description: Campaign not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - no access to this campaign
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      summary: Update campaign
      description: Update an existing campaign
      operationId: updateCampaignById
      tags: [Campaigns]
      security:
        - bearerAuth: [campaign:write]
        - oauth2: [campaign:write]
      parameters:
        - name: campaignid
          in: path
          description: Unique identifier of the campaign
          required: true
          schema:
            type: string
          example: "camp_123"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCampaignRequest'
      responses:
        '200':
          description: Campaign updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignResource'
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Campaign not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - cannot modify this campaign
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      summary: Delete campaign
      description: Delete a campaign (admin only, typically soft delete)
      operationId: deleteCampaignById
      tags: [Campaigns]
      security:
        - bearerAuth: [campaign:delete]
        - oauth2: [campaign:delete]
      parameters:
        - name: campaignid
          in: path
          description: Unique identifier of the campaign
          required: true
          schema:
            type: string
          example: "camp_123"
      responses:
        '204':
          description: Campaign deleted successfully
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Campaign not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  # ============================================================================
  # CAMPAIGN STATE MANAGEMENT
  # ============================================================================
  /campaigns/{campaignid}/pause:
    post:
      summary: Pause campaign
      description: Pause an active campaign
      operationId: pauseCampaignById
      tags: [Campaigns]
      security:
        - bearerAuth: [campaign:write]
        - oauth2: [campaign:write]
      parameters:
        - name: campaignid
          in: path
          description: Unique identifier of the campaign
          required: true
          schema:
            type: string
          example: "camp_123"
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
                  maxLength: 500
                  example: "Temporary budget adjustment"
      responses:
        '200':
          description: Campaign paused successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignResource'
        '400':
          description: Invalid request or campaign cannot be paused
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Campaign not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /campaigns/{campaignid}/resume:
    post:
      summary: Resume campaign
      description: Resume a paused campaign
      operationId: resumeCampaignById
      tags: [Campaigns]
      security:
        - bearerAuth: [campaign:write]
        - oauth2: [campaign:write]
      parameters:
        - name: campaignid
          in: path
          description: Unique identifier of the campaign
          required: true
          schema:
            type: string
          example: "camp_123"
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
                  maxLength: 500
                  example: "Ready to resume campaign"
      responses:
        '200':
          description: Campaign resumed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignResource'
        '400':
          description: Invalid request or campaign cannot be resumed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Campaign not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  # ============================================================================
  # LANDING PAGES
  # ============================================================================
  /campaigns/{campaignid}/landing-pages:
    get:
      summary: List landing pages
      description: Get landing pages for a campaign
      operationId: getCampaignLandingPagesById
      tags: [Landing Pages]
      security:
        - bearerAuth: [landing:read]
        - oauth2: [landing:read]
      parameters:
        - name: campaignid
          in: path
          description: Unique identifier of the campaign
          required: true
          schema:
            type: string
          example: "camp_123"
        - name: page
          in: query
          description: Page number for pagination (starts from 1)
          schema:
            type: integer
            default: 1
        - name: pageSize
          in: query
          description: Number of items per page
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: Landing pages list
          content:
            application/json:
              schema:
                type: object
                properties:
                  landingPages:
                    type: array
                    items:
                      $ref: '#/components/schemas/LandingPageResource'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Campaign not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      summary: Create landing page
      description: Add a landing page to a campaign
      operationId: createCampaignLandingPageById
      tags: [Landing Pages]
      security:
        - bearerAuth: [landing:write]
        - oauth2: [landing:write]
      parameters:
        - name: campaignid
          in: path
          description: Unique identifier of the campaign
          required: true
          schema:
            type: string
          example: "camp_123"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 255
                  example: "Main Squeeze Page"
                url:
                  type: string
                  format: uri
                  example: "https://example.com/page1"
                pageType:
                  $ref: '#/components/schemas/PageType'
                weight:
                  type: integer
                  minimum: 0
                  default: 100
                  example: 70
              required:
                - name
                - url
                - pageType
      responses:
        '201':
          description: Landing page created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LandingPageResource'
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Campaign not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  # ============================================================================
  # CAMPAIGN OFFERS
  # ============================================================================
  /campaigns/{campaignid}/offers:
    get:
      summary: List campaign offers
      description: Get a list of offers for a specific campaign
      operationId: getCampaignOffers
      tags: [Offers]
      security:
        - bearerAuth: [offers:read]
        - oauth2: [offers:read]
      parameters:
        - name: campaignid
          in: path
          description: Unique identifier of the campaign
          required: true
          schema:
            type: string
          example: "camp_123"
      responses:
        '200':
          description: List of campaign offers
          content:
            application/json:
              schema:
                type: object
                properties:
                  offers:
                    type: array
                    items:
                      $ref: '#/components/schemas/CampaignOfferResource'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Campaign not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      summary: Create campaign offer
      description: Add a new offer to a campaign
      operationId: createCampaignOffer
      tags: [Offers]
      security:
        - bearerAuth: [offers:write]
        - oauth2: [offers:write]
      parameters:
        - name: campaignid
          in: path
          description: Unique identifier of the campaign
          required: true
          schema:
            type: string
          example: "camp_123"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CampaignOfferResource' # Assuming CampaignOfferResource can also be a request body
      responses:
        '201':
          description: Campaign offer created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignOfferResource'
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Campaign not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  # ============================================================================
  # ANALYTICS
  # ============================================================================
  /campaigns/{campaignid}/analytics:
    get:
      summary: Get campaign analytics
      description: Get detailed analytics and performance metrics for a campaign
      operationId: getCampaignAnalyticsById
      tags: [Analytics]
      security:
        - bearerAuth: [analytics:read]
        - oauth2: [analytics:read]
      parameters:
        - name: campaignid
          in: path
          description: Unique identifier of the campaign
          required: true
          schema:
            type: string
          example: "camp_123"
        - name: startDate
          in: query
          description: Start date for analytics period (inclusive)
          schema:
            type: string
            format: date
            example: "2024-01-01"
        - name: endDate
          in: query
          description: End date for analytics period (inclusive)
          schema:
            type: string
            format: date
            example: "2024-01-31"
        - name: granularity
          in: query
          description: Time granularity for grouping analytics data
          schema:
            type: string
            enum: [hour, day, week, month]
            default: day
            example: "day"
        - name: breakdown
          in: query
          description: Dimension to break down analytics by
          schema:
            type: string
            enum: [date, traffic_source, landing_page, offer, geography, device]
            example: "date"
      responses:
        '200':
          description: Campaign analytics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignAnalytics'
        '400':
          description: Invalid date range or parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Campaign not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - no access to campaign analytics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
# ============================================================================
# CLICK TRACKING ENDPOINTS (PUBLIC)
# ============================================================================
  /click:
    get:
      summary: Track click and redirect to offer
      description: |
        **PUBLIC ENDPOINT** - Click tracking and redirection service.
        Records comprehensive click data including fraud detection and redirects users
        to either the safe page (white URL) or offer page (black URL) based on
        real-time fraud analysis and campaign targeting rules.
        **Supported Methods**: GET
        **Rate Limit**: 1000 requests/minute (public endpoint)
        **Authentication**: Not required (public tracking endpoint)
        **Redirect Behavior**: HTTP 302 redirect to offer or safe page
        ## Tracking Parameters
        - **sub1-sub5**: 5-level deep tracking for creative optimization
        - **aff_sub-aff_sub5**: Affiliate network tracking parameters
        - **click_id**: Unique click identifier for postback matching
        - **landing_page_id/campaign_offer_id**: Direct targeting parameters
        ## Fraud Detection
        - Bot pattern detection in user agent
        - IP blacklisting
        - Suspicious referrer analysis
        - Rate limiting per IP
      operationId: trackClick
      tags:
        - Traffic
      security: []
      parameters:
        - name: cid
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 2147483647
            default: 123
          description: |
            Campaign ID to attribute the click to.
            **Default**: 123 (for testing/development)
            **Validation**: Must be a positive integer
          example: 123
        # Sub-tracking parameters (5-level deep tracking)
        - name: sub1
          in: query
          schema:
            type: string
            maxLength: 255
            pattern: '^[a-zA-Z0-9._-]*$'
          description: |
            Level 1 tracking parameter - typically Creative/Ad ID.
            **Examples**: fb_ad_15, banner_728x90, email_campaign_001
            **Use**: Creative optimization and performance tracking
          example: "fb_ad_15"
        - name: sub2
          in: query
          schema:
            type: string
            maxLength: 255
            pattern: '^[a-zA-Z0-9._-]*$'
          description: |
            Level 2 tracking parameter - typically Traffic Source.
            **Examples**: facebook, google, taboola, email
            **Use**: Source attribution and media buying optimization
          example: "facebook"
        - name: sub3
          in: query
          schema:
            type: string
            maxLength: 255
            pattern: '^[a-zA-Z0-9._-]*$'
          description: |
            Level 3 tracking parameter - typically Ad Set/Campaign Group.
            **Examples**: prospecting, retargeting, lookalike_audience
            **Use**: Campaign structure optimization
          example: "adset_12"
        - name: sub4
          in: query
          schema:
            type: string
            maxLength: 255
            pattern: '^[a-zA-Z0-9._-]*$'
          description: |
            Level 4 tracking parameter - typically Ad Version/Creative Type.
            **Examples**: video1, carousel, single_image, cta_buy_now
            **Use**: Creative testing and A/B optimization
          example: "video1"
        - name: sub5
          in: query
          schema:
            type: string
            maxLength: 255
            pattern: '^[a-zA-Z0-9._-]*$'
          description: |
            Level 5 tracking parameter - typically Audience/Keyword.
            **Examples**: lookalike78, interest_gaming, keyword_cloud_computing
            **Use**: Audience segmentation and keyword optimization
          example: "lookalike78"
        # Affiliate network parameters
        - name: click_id
          in: query
          schema:
            type: string
            maxLength: 255
            pattern: '^[a-zA-Z0-9._-]*$'
          description: |
            Unique click identifier for postback/conversion matching.
            **Important**: Must be unique per click for proper conversion attribution
            **Use**: Server-to-server postback integration with affiliate networks
          example: "USERCLICK123"
        - name: aff_sub
          in: query
          schema:
            type: string
            maxLength: 255
            pattern: '^[a-zA-Z0-9._-]*$'
          description: Primary affiliate sub-identifier
          example: "aff_sub_123"
        - name: aff_sub2
          in: query
          schema:
            type: string
            maxLength: 255
            pattern: '^[a-zA-Z0-9._-]*$'
          description: Secondary affiliate sub-identifier
        - name: aff_sub3
          in: query
          schema:
            type: string
            maxLength: 255
            pattern: '^[a-zA-Z0-9._-]*$'
          description: Tertiary affiliate sub-identifier
        - name: aff_sub4
          in: query
          schema:
            type: string
            maxLength: 255
            pattern: '^[a-zA-Z0-9._-]*$'
          description: Quaternary affiliate sub-identifier
        - name: aff_sub5
          in: query
          schema:
            type: string
            maxLength: 255
            pattern: '^[a-zA-Z0-9._-]*$'
          description: Quinary affiliate sub-identifier
        # Direct targeting parameters
        - name: landing_page_id
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 2147483647
          description: |
            Specific landing page ID to force redirect to.
            **Use**: Direct linking, A/B testing bypass, troubleshooting
            **Note**: Overrides automatic landing page selection
          example: 456
        - name: campaign_offer_id
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 2147483647
          description: |
            Specific offer ID to force redirect to.
            **Use**: Direct offer linking, testing specific offers
            **Note**: Overrides automatic offer selection and rotation
          example: 789
        - name: traffic_source_id
          in: query
          schema:
            type: integer
            minimum: 1 # Added minimum constraint
            maximum: 2147483647
          description: |
            Traffic source ID for attribution tracking.
            **Use**: Multi-source traffic attribution
            **Note**: Used for analytics and reporting segmentation
          example: 101
      x-code-samples:
        - lang: curl
          label: "Basic Facebook Ad Click"
          source: |
            curl -L "https://api.advertising-platform.com/v1/click?cid=123&sub1=fb_ad_15&sub2=facebook&sub3=prospecting"
        - lang: curl
          label: "Google Ads with Affiliate Tracking"
          source: |
            curl -L "https://api.advertising-platform.com/v1/click?cid=456&sub1=google_search&sub2=google&click_id=USER123&aff_sub=network_a"
        - lang: curl
          label: "Direct Landing Page Targeting"
          source: |
            curl -L "https://api.advertising-platform.com/v1/click?cid=789&landing_page_id=101&campaign_offer_id=202"
      responses:
        '302':
          description: |
            **SUCCESS** - Click recorded and user redirected.
            Redirects to offer page (valid click) or safe page (fraudulent/invalid click).
            The redirect preserves all tracking parameters for downstream attribution.
          headers:
            Location:
              schema:
                type: string
                format: uri
              description: |
                Redirect destination URL.
                **Valid clicks**: Offer/affiliate page URL
                **Invalid clicks**: Safe page (white URL) to prevent fraud
              example: "https://example.com/offer?click_id=123e4567-e89b-12d3-a456-426614174000"
        '200':
          description: |
            **TESTING MODE** - HTML page content when redirects are not followed.
            Used for API testing tools that don't follow redirects automatically.
            Contains click information for debugging purposes.
          content:
            text/html:
              schema:
                type: string
                example: "<html><body><h1>Offer Page</h1><p>Click ID: 123e4567-e89b-12d3-a456-426614174000</p><p>Status: Valid</p></body></html>"
        '404':
          description: |
            **REDIRECT ERROR** - Campaign or destination URL not found.
            Occurs when campaign ID is invalid or configured URLs are unreachable.
          content:
            text/html:
              schema:
                type: string
                example: "<html><body><h1>Error</h1><p>Campaign not found</p></body></html>"
        '400':
          description: |
            **VALIDATION ERROR** - Invalid parameters or campaign configuration.
            Check campaign ID format and required parameters.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error:
                  code: "VALIDATION_ERROR"
                  message: "Invalid campaign ID"
                  details:
                    cid: "Campaign ID must be a positive integer"
                requestId: "req_1234567890abcdef"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /click/{clickid}:
    get:
      summary: Get click details
      description: Retrieve details of a specific click (for debugging and analytics)
      operationId: getClickById
      tags:
        - Traffic
      security:
        - bearerAuth: [traffic:read]
        - oauth2: [traffic:read]
      parameters:
        - name: clickid
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Click ID
          example: "123e4567-e89b-12d3-a456-426614174000"
      responses:
        '200':
          description: Click details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClickRecord'
        '404':
          description: Click not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - no access to click data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  # ============================================================================
  # WEBHOOKS
  # ============================================================================
  /webhooks/telegram:
    post:
      summary: Receive Telegram bot webhook
      description: |
        **PUBLIC ENDPOINT** - Receives webhook updates from Telegram Bot API.
        Processes incoming messages from Telegram bot and generates automated responses.
        Supports bot commands, user interactions, and campaign management.
        **Supported Commands:**
        - `/start` - Welcome message with inline keyboard
        - `/help` - Show available commands
        - `/stats` - Campaign statistics
        - `/campaigns` - Campaign management
        **Rate Limit**: 100 requests/second (public webhook endpoint)
        **Authentication**: Webhook secret validation (recommended)
      operationId: processTelegramWebhook
      tags: [Webhooks]
      security: []  # Public webhook endpoint
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TelegramWebhookRequest'
            example:
              update_id: 123456789
              message:
                message_id: 123
                from:
                  id: 123456789
                  username: "john_doe"
                  first_name: "John"
                  last_name: "Doe"
                chat:
                  id: 123456789
                  type: "private"
                date: 1640995200
                text: "/start"
      responses:
        '200':
          description: |
            **SUCCESS** - Webhook processed successfully.
            Returns processing status and optional bot response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TelegramWebhookResponse'
              examples:
                success:
                  summary: Successful processing with response
                  value:
                    status: "success"
                    webhook_id: "550e8400-e29b-41d4-a716-446655440000"
                    response:
                      chat_id: 123456789
                      text: "üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –Ø –±–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞–º–ø–∞–Ω–∏—è–º–∏."
                      reply_markup:
                        inline_keyboard:
                          - [{"text": "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", "callback_data": "stats"}, {"text": "üéØ –ö–∞–º–ø–∞–Ω–∏–∏", "callback_data": "campaigns"}]
                          - [{"text": "üí∞ –§–∏–Ω–∞–Ω—Å—ã", "callback_data": "finance"}, {"text": "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏", "callback_data": "settings"}]
                skipped:
                  summary: Message skipped (not supported)
                  value:
                    status: "skipped"
                    reason: "message type not supported"
        '400':
          description: |
            **VALIDATION ERROR** - Invalid webhook payload.
            Check Telegram webhook format and required fields.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error:
                  code: "VALIDATION_ERROR"
                  message: "Invalid update format"
                  details:
                    update_id: "update_id is required"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  # ============================================================================
  # EVENT TRACKING
  # ============================================================================
  /events/track:
    post:
      summary: Track user events
      description: |
        **PUBLIC ENDPOINT** - Track user interactions and events on landing pages.
        Captures comprehensive event data including clicks, form interactions, scroll depth,
        time spent, conversions, and custom events. Includes fraud detection and
        automatic session/user identification.
        **Supported Event Types:**
        - `page_view` - Page view events
        - `click` - Click interactions
        - `form_submit`, `form_start`, `form_complete` - Form interactions
        - `scroll` - Scroll depth tracking
        - `time_spent` - Time spent on page
        - `conversion` - Conversion events
        - `purchase` - Purchase completions
        - `signup` - User registrations
        - `video_play`, `video_complete` - Video interactions
        - `custom` - Custom events
        **Rate Limit**: 1000 requests/minute (public tracking endpoint)
        **Authentication**: Not required (public tracking endpoint)
      operationId: trackEvent
      tags: [Events]
      security: []  # Public endpoint
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EventTrackingRequest'
            examples:
              button_click:
                summary: Button click event
                value:
                  event_type: "click"
                  event_name: "cta_button_click"
                  click_id: "123e4567-e89b-12d3-a456-426614174000"
                  campaign_id: 123
                  landing_page_id: 456
                  url: "https://example.com/landing-page"
                  properties:
                    button_text: "Buy Now"
                    button_position: "hero_section"
              form_submit:
                summary: Form submission event
                value:
                  event_type: "form_submit"
                  event_name: "lead_form_submit"
                  session_id: "session_123456"
                  campaign_id: 123
                  landing_page_id: 456
                  properties:
                    form_type: "email_capture"
                    fields_completed: ["name", "email", "phone"]
              page_view:
                summary: Page view event
                value:
                  event_type: "page_view"
                  event_name: "landing_page_view"
                  click_id: "123e4567-e89b-12d3-a456-426614174000"
                  campaign_id: 123
                  landing_page_id: 456
                  url: "https://example.com/landing-page"
                  referrer: "https://facebook.com/ad/123"
      responses:
        '200':
          description: |
            **SUCCESS** - Event tracked successfully.
            Returns event ID and analytics categories for the tracked event.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EventTrackingResponse'
              examples:
                success:
                  summary: Successful event tracking
                  value:
                    status: "success"
                    event_id: "550e8400-e29b-41d4-a716-446655440000"
                    categories: ["interaction", "cta_interaction"]
                    fraud_detected: false
                fraud_detected:
                  summary: Event tracked but fraud detected
                  value:
                    status: "success"
                    event_id: "550e8400-e29b-41d4-a716-446655440000"
                    categories: ["interaction"]
                    fraud_detected: true
        '400':
          description: |
            **VALIDATION ERROR** - Invalid event data.
            Check event_type, event_name, and other required fields.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error:
                  code: "VALIDATION_ERROR"
                  message: "Invalid event data"
                  details:
                    event_type: "event_type must be one of: page_view, click, ..."
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  # ============================================================================
  # CONVERSION TRACKING
  # ============================================================================
  /conversions/track:
    post:
      summary: Track conversions
      description: |
        **PROTECTED ENDPOINT** - Track conversions (leads, sales, signups) from external systems.
        Links conversions back to original clicks for attribution and revenue tracking.
        Triggers automated postback notifications to affiliate networks and partners.
        Includes fraud detection and duplicate prevention.
        **Supported Conversion Types:**
        - `lead` - Lead generation (email, phone, etc.)
        - `sale` - Product/service purchase
        - `install` - App/software installation
        - `registration` - User account creation
        - `signup` - Newsletter/content subscription
        **Attribution**: Last-click attribution model with time-decay confidence scoring
        **Fraud Detection**: Automated fraud scoring based on click validity and patterns
        **Postbacks**: Automatic notification sending to configured affiliate networks
      operationId: trackConversion
      tags: [Conversions]
      security:
        - bearerAuth: [conversions:write]
        - apiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConversionTrackingRequest'
            examples:
              lead_conversion:
                summary: Lead conversion tracking
                value:
                  click_id: "123e4567-e89b-12d3-a456-426614174000"
                  conversion_type: "lead"
                  order_id: "LEAD_123456"
                  metadata:
                    lead_source: "contact_form"
                    lead_quality: "high"
                    follow_up_required: true
              sale_conversion:
                summary: Sale conversion with revenue
                value:
                  click_id: "123e4567-e89b-12d3-a456-426614174000"
                  conversion_type: "sale"
                  conversion_value:
                    amount: 99.99
                    currency: "USD"
                  order_id: "ORDER_789012"
                  product_id: "premium_package"
                  metadata:
                    payment_method: "credit_card"
                    discount_code: "SUMMER2024"
                    upsell_offered: true
      responses:
        '200':
          description: |
            **SUCCESS** - Conversion tracked successfully.
            Returns conversion ID and attribution data. Postback notifications
            are triggered asynchronously for affiliate network updates.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConversionTrackingResponse'
              examples:
                success:
                  summary: Successful conversion tracking
                  value:
                    status: "success"
                    conversion_id: "550e8400-e29b-41d4-a716-446655440000"
                    attribution:
                      attribution_model: "last_click"
                      attribution_confidence: 0.95
                      time_to_conversion: 3600.5
                      touchpoints: 1
                    fraud_detected: false
                    postback_triggered: true
                fraud_detected:
                  summary: Conversion tracked but fraud detected
                  value:
                    status: "success"
                    conversion_id: "550e8400-e29b-41d4-a716-446655440000"
                    attribution:
                      attribution_model: "last_click"
                      attribution_confidence: 0.3
                      time_to_conversion: 5.2
                      touchpoints: 1
                    fraud_detected: true
                    postback_triggered: false
        '400':
          description: |
            **VALIDATION ERROR** - Invalid conversion data or click not found.
            Check click_id exists and conversion_type is valid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error:
                  code: "VALIDATION_ERROR"
                  message: "Click ID not found"
                  details:
                    click_id: "Click with this ID does not exist"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  # ============================================================================
  # POSTBACKS
  # ============================================================================
  /postbacks/send:
    post:
      summary: Send postback notification
      description: |
        **PROTECTED ENDPOINT** - Send postback notification to external affiliate network or system.
        Automatically builds postback URLs with conversion parameters and handles delivery
        with retry logic and failure tracking. Supports GET (URL parameters) and POST (JSON payload)
        methods with custom headers and authentication.
        **URL Parameter Substitution:**
        - `{click_id}` - Original click identifier
        - `{conversion_id}` - Conversion identifier
        - `{conversion_type}` - Type of conversion (lead, sale, etc.)
        - `{revenue}` - Conversion revenue amount
        - `{currency}` - Conversion currency code
        - `{order_id}` - External order identifier
        **Retry Logic:** Exponential backoff (1min, 2min, 4min, 8min) up to max_attempts
        **Authentication:** Supports Bearer tokens and API keys in headers
      operationId: sendPostback
      tags: [Postbacks]
      security:
        - bearerAuth: [postbacks:write]
        - apiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PostbackSendRequest'
            examples:
              get_postback:
                summary: GET postback with URL parameters
                value:
                  conversion_id: "550e8400-e29b-41d4-a716-446655440000"
                  postback_config:
                    url: "https://affiliate-network.com/postback?click_id={click_id}&amount={revenue}&type={conversion_type}"
                    method: "GET"
                    max_attempts: 3
              post_postback:
                summary: POST postback with JSON payload
                value:
                  conversion_id: "550e8400-e29b-41d4-a716-446655440000"
                  postback_config:
                    url: "https://api.affiliate.com/conversions"
                    method: "POST"
                    headers:
                      Authorization: "Bearer your_token"
                      Content-Type: "application/json"
                    payload:
                      click_id: "{click_id}"
                      conversion_type: "{conversion_type}"
                      revenue: "{revenue}"
                      currency: "{currency}"
                      order_id: "{order_id}"
                    max_attempts: 5
      responses:
        '200':
          description: |
            **SUCCESS** - Postback sent successfully.
            Returns delivery status and response details from external system.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostbackSendResponse'
              examples:
                success:
                  summary: Successful postback delivery
                  value:
                    status: "success"
                    postback_id: "550e8400-e29b-41d4-a716-446655440000"
                    response_code: 200
                    response_body: "Conversion recorded"
                    attempt_count: 1
                queued_retry:
                  summary: Postback queued for retry
                  value:
                    status: "failed"
                    postback_id: "550e8400-e29b-41d4-a716-446655440000"
                    response_code: 500
                    response_body: "Internal Server Error"
                    error_message: "Server temporarily unavailable"
                    attempt_count: 1
        '400':
          description: |
            **VALIDATION ERROR** - Invalid request or conversion not found.
            Check conversion_id exists and postback_config is valid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error:
                  code: "VALIDATION_ERROR"
                  message: "Conversion not found"
                  details:
                    conversion_id: "Conversion with this ID does not exist"
        '502':
          description: |
            **BAD GATEWAY** - External postback endpoint failed.
            Postback was attempted but external service returned error.
            Will be retried according to retry policy.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostbackSendResponse'
              example:
                status: "failed"
                postback_id: "550e8400-e29b-41d4-a716-446655440000"
                response_code: 502
                error_message: "External service error"
                attempt_count: 1
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  # ============================================================================
  # CLICK GENERATION
  # ============================================================================
  /clicks/generate:
    post:
      summary: Generate click tracking URLs
      description: |
        **PROTECTED ENDPOINT** - Generate personalized click tracking URLs with proper attribution parameters.
        Creates tracking links that automatically include campaign ID, timestamps, sub-tracking parameters,
        and affiliate network identifiers. Supports both single URL generation and bulk generation
        for A/B testing and multi-creative campaigns.
        **Parameter Hierarchy:**
        - `cid`: Campaign ID (always included)
        - `ts`: Unix timestamp (always included)
        - `landing_page_id`: Direct landing page targeting
        - `campaign_offer_id`: Direct offer targeting
        - `sub1-sub5`: 5-level deep tracking parameters
        - `click_id`: Affiliate network click ID
        - `aff_sub-aff_sub5`: Affiliate sub-identifiers
        **Supported Formats:**
        - Single URL: Generate one tracking URL
        - Bulk generation: Generate multiple variations with different parameters
        - Parameter optimization: Automatic parameter cleaning and validation
      operationId: generateClicks
      tags: [Clicks]
      security:
        - bearerAuth: [clicks:write]
        - oauth2: [clicks:write]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/ClickGenerationRequest'
                - $ref: '#/components/schemas/BulkClickGenerationRequest'
        description: |
          Either a single URL generation request or bulk generation with variations.
          Use `variations` array for bulk generation, otherwise single URL generation.
      responses:
        '200':
          description: |
            **SUCCESS** - Tracking URL(s) generated successfully.
            Returns the generated tracking URL(s) with all attribution parameters included.
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/ClickGenerationResponse'
                  - $ref: '#/components/schemas/BulkClickGenerationResponse'
              examples:
                single_url:
                  summary: Single URL generation
                  value:
                    status: "success"
                    tracking_url: "https://example.com/landing-page?cid=123&ts=1640995200&sub1=fb_ad_15&sub2=facebook&landing_page_id=456"
                    campaign_id: 123
                    params:
                      sub1: "fb_ad_15"
                      sub2: "facebook"
                      _generated_at: 1640995200
                      _version: "1.0"
                    landing_page_id: 456
                bulk_generation:
                  summary: Bulk URL generation
                  value:
                    status: "success"
                    total_variations: 3
                    successful: 3
                    failed: 0
                    results:
                      - id: "variation_1"
                        name: "Facebook Prospecting"
                        url: "https://example.com/landing-page?cid=123&ts=1640995200&sub1=fb_ad_15&sub2=facebook&sub3=prospecting"
                        params:
                          sub1: "fb_ad_15"
                          sub2: "facebook"
                          sub3: "prospecting"
                        status: "success"
                      - id: "variation_2"
                        name: "Google Search"
                        url: "https://example.com/landing-page?cid=123&ts=1640995200&sub1=google_search&sub2=google&sub3=search"
                        params:
                          sub1: "google_search"
                          sub2: "google"
                          sub3: "search"
                        status: "success"
        '400':
          description: |
            **VALIDATION ERROR** - Invalid request parameters.
            Check campaign_id format, base_url validity, and parameter constraints.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error:
                  code: "VALIDATION_ERROR"
                  message: "campaign_id must be a positive integer"
                  details:
                    campaign_id: "Must be greater than 0"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  # ============================================================================
  # GOAL MANAGEMENT
  # ============================================================================
  /goals:
    get:
      summary: List goals
      description: |
        **PROTECTED ENDPOINT** - Get a list of conversion goals with optional filtering.
        Supports filtering by campaign, goal type, tags, and active status.
        Results are paginated and include goal performance metrics.
      operationId: getGoals
      tags: [Goals]
      security:
        - bearerAuth: [goals:read]
        - oauth2: [goals:read]
      parameters:
        - name: campaign_id
          in: query
          schema:
            type: integer
          description: Filter goals by campaign ID
          example: 123
        - name: goal_type
          in: query
          schema:
            type: string
            enum: [lead, sale, signup, registration, download, view, time_spent, custom]
          description: Filter goals by type
          example: "lead"
        - name: tag
          in: query
          schema:
            type: string
          description: Filter goals by tag
          example: "form"
        - name: active_only
          in: query
          schema:
            type: boolean
            default: true
          description: Include only active goals
          example: true
        - name: page
          in: query
          schema:
            type: integer
            default: 1
            minimum: 1
          description: Page number
        - name: pageSize
          in: query
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
          description: Number of goals per page
      responses:
        '200':
          description: List of goals
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GoalCollection'
              example:
                status: "success"
                goals:
                  - id: "goal_550e8400-e29b-41d4-a716-446655440000"
                    campaign_id: 123
                    name: "Lead Form Submission"
                    goal_type: "lead"
                    trigger_type: "event"
                    trigger_config:
                      event_type: "form_submit"
                      event_name: "lead_form_submit"
                    is_active: true
                    attribution_window_days: 30
                    priority: 1
                    tags: ["form", "lead", "conversion"]
                    created_at: "2024-01-01T00:00:00Z"
                    updated_at: "2024-01-01T00:00:00Z"
                total: 1
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      summary: Create goal
      description: |
        **PROTECTED ENDPOINT** - Create a new conversion goal for tracking specific user actions.
        Goals define what constitutes a successful conversion for your campaigns,
        including how they're triggered and how their value is calculated.
      operationId: createGoal
      tags: [Goals]
      security:
        - bearerAuth: [goals:write]
        - oauth2: [goals:write]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGoalRequest'
            examples:
              lead_goal:
                summary: Lead capture goal
                value:
                  campaign_id: 123
                  name: "Lead Form Submission"
                  description: "Track when visitors submit lead capture forms"
                  goal_type: "lead"
                  trigger_type: "event"
                  trigger_config:
                    event_type: "form_submit"
                    event_name: "lead_form_submit"
                  value_config:
                    fixed_value: 5.00
                  attribution_window_days: 30
                  tags: ["form", "lead"]
              sale_goal:
                summary: Product sale goal
                value:
                  campaign_id: 123
                  name: "Product Purchase"
                  goal_type: "sale"
                  trigger_type: "event"
                  trigger_config:
                    event_type: "conversion"
                    event_name: "purchase_complete"
                  value_config:
                    revenue_field: "order_total"
                  attribution_window_days: 30
                  tags: ["ecommerce", "revenue"]
      responses:
        '201':
          description: Goal created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  goal_id:
                    type: string
                    example: "goal_550e8400-e29b-41d4-a716-446655440000"
                  goal:
                    $ref: '#/components/schemas/GoalResource'
        '400':
          description: Invalid goal configuration
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error:
                  code: "VALIDATION_ERROR"
                  message: "trigger_config required for event-based goals"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /goals/templates:
    get:
      summary: Get goal templates
      description: |
        **PROTECTED ENDPOINT** - Get predefined goal templates for common conversion scenarios.
        Templates provide starting configurations for typical goals like form submissions,
        purchases, signups, and engagement metrics.
      operationId: getGoalTemplates
      tags: [Goals]
      security:
        - bearerAuth: [goals:read]
        - oauth2: [goals:read]
      responses:
        '200':
          description: List of goal templates
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  templates:
                    type: array
                    items:
                      $ref: '#/components/schemas/GoalTemplate'
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Templates not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /goals/{goalid}:
    get:
      summary: Get goal
      description: Get detailed information about a specific conversion goal
      operationId: getGoalById
      tags: [Goals]
      security:
        - bearerAuth: [goals:read]
        - oauth2: [goals:read]
      parameters:
        - name: goalid
          in: path
          required: true
          schema:
            type: string
          description: Goal ID
          example: "goal_550e8400-e29b-41d4-a716-446655440000"
      responses:
        '200':
          description: Goal details
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  goal:
                    $ref: '#/components/schemas/GoalResource'
        '404':
          description: Goal not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      summary: Update goal
      description: Update an existing conversion goal's configuration
      operationId: updateGoalById
      tags: [Goals]
      security:
        - bearerAuth: [goals:write]
        - oauth2: [goals:write]
      parameters:
        - name: goalid
          in: path
          required: true
          schema:
            type: string
          description: Goal ID
          example: "goal_550e8400-e29b-41d4-a716-446655440000"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateGoalRequest'
      responses:
        '200':
          description: Goal updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  goal:
                    $ref: '#/components/schemas/GoalResource'
        '404':
          description: Goal not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      summary: Delete goal
      description: Delete a conversion goal (soft delete - marks as inactive)
      operationId: deleteGoalById
      tags: [Goals]
      security:
        - bearerAuth: [goals:delete]
        - oauth2: [goals:delete]
      parameters:
        - name: goalid
          in: path
          required: true
          schema:
            type: string
          description: Goal ID
          example: "goal_550e8400-e29b-41d4-a716-446655440000"
      responses:
        '200':
          description: Goal deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Goal deleted successfully"
        '404':
          description: Goal not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /goals/{goalid}/duplicate:
    post:
      summary: Duplicate goal
      description: Create a copy of an existing goal, optionally for a different campaign
      operationId: duplicateGoalById
      tags: [Goals]
      security:
        - bearerAuth: [goals:write]
        - oauth2: [goals:write]
      parameters:
        - name: goalid
          in: path
          required: true
          schema:
            type: string
          description: Goal ID to duplicate
          example: "goal_550e8400-e29b-41d4-a716-446655440000"
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                campaign_id:
                  type: integer
                  description: Campaign ID for the duplicated goal (optional)
                  example: 456
      responses:
        '201':
          description: Goal duplicated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  goal:
                    $ref: '#/components/schemas/GoalResource'
        '404':
          description: Original goal not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /clicks:
    get:
      summary: List clicks
      description: |-
        Retrieve a list of clicks with optional filtering.
        
        **Authentication**: Supports multiple methods (Bearer token, OAuth2, or API Key).
        Any valid authentication method is acceptable (OR logic).
      operationId: trackClicks
      tags:
        - Traffic
      security:
        - bearerAuth: [traffic:read]
        - oauth2: [traffic:read]
      parameters:
        - name: cid
          in: query
          schema:
            type: integer
          description: Filter by campaign ID
          example: 123
        - name: sub1
          in: query
          schema:
            type: string
          description: Filter by sub1 (creative ID)
          example: "fb_ad_15"
        - name: sub2
          in: query
          schema:
            type: string
          description: Filter by sub2 (traffic source)
          example: "facebook"
        - name: is_valid
          in: query
          schema:
            type: integer
            enum: [0, 1]
          description: Filter by validity (0=invalid, 1=valid)
          example: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
          description: Maximum number of clicks to return
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
          description: Number of clicks to skip
      responses:
        '200':
          description: List of clicks
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClickList'
        '400':
          description: Invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '422':
          description: Validation error (invalid query parameters)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: |-
            Unauthorized - authentication required or invalid.
            
            Returned when:
            - No authentication headers provided
            - Invalid Bearer token
            - Invalid API key
            - Invalid OAuth2 token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - no access to click data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            text/html:
              schema:
                type: string
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
# ============================================================================
# CUSTOMER JOURNEY ANALYSIS
# ============================================================================
  /journeys/funnel:
    get:
      summary: Get customer journey funnel
      description: Analyze customer funnel stages and conversion rates across campaigns
      operationId: getJourneyFunnel
      tags: [Journeys]
      security:
        - bearerAuth: [analytics:read]
        - oauth2: [analytics:read]
      parameters:
        - name: campaign_id
          in: query
          schema:
            type: integer
          description: Filter by campaign ID
        - name: days
          in: query
          schema:
            type: integer
            default: 30
            minimum: 1
            maximum: 365
          description: Analysis period in days
      responses:
        '200':
          description: Funnel analysis results
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  period_days:
                    type: integer
                    example: 30
                  total_journeys:
                    type: integer
                    example: 1000
                  funnel_stages:
                    type: object
                    properties:
                      awareness:
                        type: integer
                        example: 800
                      interest:
                        type: integer
                        example: 600
                      consideration:
                        type: integer
                        example: 300
                      purchase:
                        type: integer
                        example: 150
                      retention:
                        type: integer
                        example: 100
                  conversion_rates:
                    type: object
                    properties:
                      awareness_to_interest:
                        type: number
                        format: float
                        example: 0.75
                      interest_to_consideration:
                        type: number
                        format: float
                        example: 0.5
                      consideration_to_purchase:
                        type: number
                        format: float
                        example: 0.5
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Campaign not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /journeys/drop-off:
    get:
      summary: Analyze customer journey drop-off points
      description: Identify where customers drop off in their journey before conversion
      operationId: getJourneyDropOff
      tags: [Journeys]
      security:
        - bearerAuth: [analytics:read]
        - oauth2: [analytics:read]
      parameters:
        - name: campaign_id
          in: query
          schema:
            type: integer
          description: Filter by campaign ID
        - name: days
          in: query
          schema:
            type: integer
            default: 30
          description: Analysis period in days
      responses:
        '200':
          description: Drop-off analysis results
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  drop_off_points:
                    type: array
                    items:
                      type: object
                      properties:
                        stage:
                          type: string
                          example: "consideration"
                        users_dropped:
                          type: integer
                          example: 200
                        percentage:
                          type: number
                          format: float
                          example: 0.4
                  period_days:
                    type: integer
                    example: 30
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Campaign not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
# ============================================================================
# LTV TRACKING
# ============================================================================
  /ltv/analysis:
    get:
      summary: Get LTV analysis
      description: Analyze customer lifetime value and profitability metrics
      operationId: getLtvAnalysis
      tags: [LTV]
      security:
        - bearerAuth: [analytics:read]
        - oauth2: [analytics:read]
      parameters:
        - name: campaign_id
          in: query
          schema:
            type: integer
          description: Filter by campaign ID
        - name: cohort_period
          in: query
          schema:
            type: string
            enum: [monthly, quarterly, yearly]
            default: monthly
          description: Cohort analysis period
      responses:
        '200':
          description: LTV analysis results
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  average_ltv:
                    type: number
                    format: float
                    example: 125.50
                  total_customers:
                    type: integer
                    example: 1000
                  total_revenue:
                    type: number
                    format: float
                    example: 125500.00
                  cohort_analysis:
                    type: object
                    additionalProperties:
                      type: object
                      properties:
                        customers:
                          type: integer
                          example: 100
                        revenue:
                          type: number
                          format: float
                          example: 12500
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Campaign not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
# ============================================================================
# FORM INTEGRATION
# ============================================================================
  /forms/submit:
    post:
      summary: Submit form data
      description: Handle form submissions and lead capture from landing pages
      operationId: submitForm
      tags: [Forms]
      security: []  # Public endpoint for form submissions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                form_id:
                  type: string
                  example: "contact_form"
                campaign_id:
                  type: integer
                  example: 123
                fields:
                  type: object
                  additionalProperties: true
                  example:
                    name: "John Doe"
                    email: "john@example.com"
                    phone: "+1234567890"
                metadata:
                  type: object
                  additionalProperties: true
                  example:
                    user_agent: "Mozilla/5.0..."
                    referrer: "https://facebook.com"
      responses:
        '200':
          description: Form submitted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  lead_id:
                    type: string
                    example: "lead_123"
                  message:
                    type: string
                    example: "Form submitted successfully"
        '400':
          description: Invalid form data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
# ============================================================================
# RETENTION CAMPAIGNS
# ============================================================================
  /retention/campaigns:
    get:
      summary: List retention campaigns
      description: Get active retention campaigns and their performance
      operationId: getRetentionCampaigns
      tags: [Retention]
      security:
        - bearerAuth: [campaigns:read]
        - oauth2: [campaigns:read]
      responses:
        '200':
          description: List of retention campaigns
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  campaigns:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          example: "retention_1"
                        name:
                          type: string
                          example: "Welcome Back Campaign"
                        target_audience:
                          type: string
                          example: "inactive_users_30_days"
                        status:
                          type: string
                          enum: [active, paused, completed]
                          example: "active"
                        performance:
                          type: object
                          properties:
                            sent:
                              type: integer
                              example: 5000
                            opened:
                              type: integer
                              example: 1250
                            clicked:
                              type: integer
                              example: 375
                            converted:
                              type: integer
                              example: 75
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Campaign not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
# ============================================================================
# TAGS
# ============================================================================
tags:
  - name: Health
    description: |
      API health check and status monitoring endpoints.
  - name: Campaigns
    description: |
      Campaign management operations including CRUD, state management (pause/resume),
      and performance tracking. Supports A/B testing and budget management.
  - name: Landing Pages
    description: |
      Landing page management within campaigns including creation, rotation,
      A/B testing, and performance optimization.
  - name: Offers
    description: |
      Campaign offer management including creation, rotation, payout configuration,
      and performance optimization.
  - name: Analytics
    description: |
      Comprehensive performance analytics with multi-dimensional breakdowns
      including date, traffic source, landing page, offer, geography, and device.
  - name: Traffic
    description: |
      Traffic acquisition and click tracking with fraud detection,
      multi-level sub-tracking, and conversion attribution.
  - name: Clicks
    description: |
      Click tracking and URL generation for campaign attribution,
      including bulk generation and parameter optimization.
  - name: Conversions
    description: |
      Conversion tracking and partner postbacks for affiliate network integration
      and revenue optimization.
  - name: Postbacks
    description: |
      Postback notifications to external systems including affiliate networks,
      CRM platforms, and third-party services with retry logic and delivery tracking.
  - name: Goals
    description: |
      Conversion goal management including creation, configuration, and evaluation
      of goals that define successful campaign outcomes and conversion tracking.
  - name: Journeys
    description: |
      Customer journey analysis including funnel tracking, drop-off analysis,
      and attribution modeling for understanding user behavior across touchpoints.
  - name: LTV
    description: |
      Lifetime Value analysis including customer profitability, cohort analysis,
      and predictive modeling for long-term revenue forecasting.
  - name: Forms
    description: |
      Form integration and lead capture including submission handling,
      validation, and data processing for marketing automation.
  - name: Retention
    description: |
      Customer retention campaigns and analysis including churn prediction,
      re-engagement strategies, and loyalty program management.
  - name: Webhooks
    description: |
      Webhook endpoints for external integrations including Telegram bot webhooks,
      payment notifications, and external system callbacks.
  - name: Events
    description: |
      Event tracking endpoints for capturing user interactions on landing pages,
      including clicks, form submissions, conversions, and custom events with fraud detection.
# ============================================================================
# EXTERNAL DOCUMENTATION AND SUPPORT
# ============================================================================
externalDocs:
  description: Domain-Driven Design Documentation
  url: https://github.com/yourorg/ad-platform-ddd
# Support and contact information
x-support:
  contact:
    name: API Support Team
    email: api-support@advertising-platform.com
    url: https://support.advertising-platform.com
  termsOfService: https://advertising-platform.com/terms
  sla:
    uptime: "99.9%"
    responseTime: "< 200ms P95"
    supportHours: "24/7"